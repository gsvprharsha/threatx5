# Introduction

Wannacry ransomware gained widespread attention in May of 2017, after it caused major disruptions worldwide. This strain of malware particularly targeted computers that ran the <a href="https://en.wikipedia.org/wiki/Microsoft_Windows" style="color:#60A5FA; font-weight:bold;">Windows</a> Operating System. It exploited the vulnerability called EternalBlue, a type of SMB Vulnerability [[1](https://en.wikipedia.org/wiki/WannaCry_ransomware_attack)].

Once it spread, WannaCry quickly infected hundreds of thousands of computers in over 150 countries, making it one of the most major ransomware attacks in recent history. The ransomware takes advantage of this vulnerability to compromise Windows machines, load malware, and propagate to other machines in a network. The attack uses **SMB version 1** and **TCP port 445** to propagate [[2](https://cloud.google.com/blog/topics/threat-intelligence/smb-exploited-wannacry-use-of-eternalblue)].

<br>

# Timeline

The following table gives a broad record of events of the attack [[1](https://en.wikipedia.org/wiki/WannaCry_ransomware_attack)].

<br>

<div style="padding-left: 50px; padding-right: 50px;">
  <table style="border-collapse: collapse; width: 100%; border: 1px solid white; font-size: small;">
    <thead>
      <tr>
        <th style="border: 1px solid white; padding: 8px; font-size: medium; text-align: center">Date and Timestamp</th>
        <th style="border: 1px solid white; padding: 8px; font-size: medium; text-align: center">Event</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">14 March 2017</td>
        <td style="border: 1px solid white; padding: 8px;">Microsoft releases security bulletin <a href="https://learn.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010">MS17-010</a>, addressing the SMB vulnerability exploited by EternalBlue.</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">14 April 2017</td>
        <td style="border: 1px solid white; padding: 8px;">The Shadow Brokers leak the EternalBlue exploit and DoublePulsar backdoor tool.</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">9 May 2017</td>
        <td style="border: 1px solid white; padding: 8px;">RiskSense publishes proof-of-concept code for CVE-2017-0144 on GitHub.</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">12 May 2017, 07:44 UTC</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry ransomware attack begins, with initial infection likely in Asia via an exposed SMB port.</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">12 May 2017, 15:03 UTC</td>
        <td style="border: 1px solid white; padding: 8px;">Marcus Hutchins registers the kill switch domain, significantly slowing the spread of WannaCry.</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">13 May 2017</td>
        <td style="border: 1px solid white; padding: 8px;">Microsoft releases out-of-band security updates for unsupported systems, including Windows XP and Windows Server 2003.</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">14 May 2017</td>
        <td style="border: 1px solid white; padding: 8px;">A first variant of WannaCry with a new kill switch appears. Matt Suiche registers the second kill switch domain.</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">15 May 2017</td>
        <td style="border: 1px solid white; padding: 8px;">A second variant of WannaCry with a third kill switch is identified. Check Point registers the third kill switch domain.</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">19 May 2017</td>
        <td style="border: 1px solid white; padding: 8px;">Mirai botnet variant attempts a DDoS attack on the WannaCry kill-switch domain.</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">22 May 2017</td>
        <td style="border: 1px solid white; padding: 8px;">Marcus Hutchins protects the kill-switch domain by switching to a cached version to handle higher traffic.</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">August 2018</td>
        <td style="border: 1px solid white; padding: 8px;">A new variant of WannaCry forces TSMC to shut down several chip-fabrication factories after infecting 10,000 machines.</td>
      </tr>
    </tbody>
  </table>
</div>

<br>

# Characteristics

The WannaCry ransomware is known for its distinctive characteristics that contributed to its rapid spread and widespread impact. Among these, the exploitation of the <a href="https://en.wikipedia.org/wiki/EternalBlue" style="color:#60A5FA; font-weight:bold;">EternalBlue</a> vulnerability in Windows systems stands out as a critical factor, allowing the malware to propagate across networks. Below are some of the key characteristics that define this ransomware.

<br>

## EternalBlue Exploit

The SMBv1 server in several Microsoft Windows versions, including 

<li style="font-size: small;">Vista SP2</li>
<li style="font-size: small;">Windows Server 2008 SP2 and R2 SP1</li>
<li style="font-size: small;">Windows 7 SP1</li>
<li style="font-size: small;">Windows 8.1</li>
<li style="font-size: small;">Windows Server 2012 (original and R2)</li>
<li style="font-size: small;">Windows RT 8.1</li>
<li style="font-size: small;">Windows 10 (versions Gold, 1511, and 1607)</li>
<li style="font-size: small;">Windows Server 2016</li>

has a vulnerability that lets attackers run unauthorized code. This happens when the server processes specially crafted packets. This flaw is distinct from the vulnerabilities identified as CVE-2017-0143, CVE-2017-0145, CVE-2017-0146, and CVE-2017-0148 [[3](https://nvd.nist.gov/vuln/detail/CVE-2017-0144)].

<br>

## Working of Wannacry

WannaCry is a modular ransomware that uses advanced techniques to spread and encrypt data on targeted systems. Here's how it operates [[2](https://cloud.google.com/blog/topics/threat-intelligence/smb-exploited-wannacry-use-of-eternalblue)] [[8](https://blog.talosintelligence.com/wannacry/)]:

<br>


### Initial Infection
WannaCry begins with the execution of a file named ``mssecsvc.exe``. This file drops and runs ``tasksche.exe``, which checks the kill switch domains to determine whether to proceed. If no kill switch is detected, the malware creates a persistent service named ``mssecsvc2.0``. This service executes mssecsvc.exe with a different entry point, triggering two threads:

<br>

- 1.&nbsp;WannaCry begins with the execution of a file named ``mssecsvc.exe``. This file drops and runs ``tasksche.exe``, which checks the kill switch domains to determine whether to proceed. If no kill switch is detected, the malware creates a persistent service named ``mssecsvc2.0``. This service executes ``mssecsvc.exe`` with a different entry point, triggering two threads:

    - a) The first thread scans the local subnet for machines and attempts to connect to **TCP port 445 (SMB)**.
    - b) The second thread generates random IP addresses and tries to connect to SMB on those addresses.

- The malware exploits the SMB vulnerability known as EternalBlue (addressed by Microsoft in MS17-010) to install a backdoor named ``DOUBLEPULSAR``. This backdoor allows the malware to deploy itself on new machines.

<br>

### Propogation

After establishing a connection with a vulnerable system, WannaCry connects to the ``IPC$`` share on the remote machine.

<br>
<figure class="image-caption">
  <img src="/images/malware/wannacry/connecting_to_IPC.png" alt="Description of the image">
  <figcaption>Fig-1: Connecting to the IPC$ share <a href="https://cloud.google.com/blog/topics/threat-intelligence/smb-exploited-wannacry-use-of-eternalblue/" style="color:#60A5FA; font-weight:bold;"> Image Source: Google Cloud (Mandiant) [2]</a> </figcaption>
</figure>

The malware then sends a specially crafted NT Trans request to exploit the SMB server's vulnerability. This request contains NOP sequences to prepare the server for exploitation.

<br>
<figure class="image-caption">
  <img src="/images/malware/wannacry/preparing_server_for_exploit.png" alt="Description of the image">
  <figcaption>Fig-1: Connecting to the IPC$ share <a href="https://cloud.google.com/blog/topics/threat-intelligence/smb-exploited-wannacry-use-of-eternalblue/" style="color:#60A5FA; font-weight:bold;"> Image Source: Google Cloud (Mandiant) [2]</a> </figcaption>
</figure>

Next, WannaCry sends malformed Secondary ``Trans2`` requests. These trigger the vulnerability and include shellcode and the encrypted ransomware payload.

<br>
<figure class="image-caption">
  <img src="/images/malware/wannacry/overflow.png" alt="Description of the image">
  <figcaption>Fig-1: Connecting to the IPC$ share <a href="https://cloud.google.com/blog/topics/threat-intelligence/smb-exploited-wannacry-use-of-eternalblue/" style="color:#60A5FA; font-weight:bold;"> Image Source: Google Cloud (Mandiant) [2]</a> </figcaption>
</figure>

Once the payload is executed, the malware installs the mssecsvc service on the new machine, enabling further scanning and propagation.

<br>

### Encryption Process

WannaCry uses ``tasksche.exe`` to identify and encrypt files. It scans local drives, network shares, and removable storage for specific file types listed in its code. The encryption uses **2048-bit RSA keys**, rendering the files inaccessible without the decryption key.

- a.&nbsp;While encrypting, the malware creates a directory named ``Tor/``, which stores ``tor.exe`` and its associated DLLs.
- b.&nbsp;It also drops ``taskdl.exe`` to delete temporary files and ``taskse.exe`` to launch ``@wanadecryptor@.exe``, which displays the ransom note.

<br>

### The Communication

WannaCry uses the Tor network for anonymity. The ``@wanadecryptor@.exe`` executable connects to Tor nodes, allowing the ransomware operators to communicate without revealing their location.

<br>

### System Alterations

WannaCry deletes shadow copies on the victim’s machine to prevent recovery. It achieves this using tools like ``WMIC.exe``, ``vssadmin.exe``, and ``cmd.exe``. Additionally, it modifies file attributes with ``attrib.exe`` and grants full access permissions using ``icacls.exe``.

<br>

### Ransom Note

After encryption, WannaCry displays a ransom note through ``@wanadecryptor@.exe``. This executable instructs victims to pay in Bitcoin for file decryption.

<br>

# The Kill Switch

WannaCry has a kill switch that checks if a specific domain **``iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea[.]com``** is active. If the domain is found, the ransomware stops. If the domain is not registered or cannot be reached, the malware continues to encrypt files and spread to other systems.

<br>

# The IOCs
The following table contains a list of IOCs for Wannacry Ransomware [4]

<div style="padding-left: 50px; padding-right: 50px;" class="table-container">
  <table style="border-collapse: collapse; width: 100%; border: 1px solid white; font-size: small;">
    <thead>
      <tr>
        <th style="border: 1px solid white; padding: 8px; font-size: medium; text-align: center">Type</th>
        <th style="border: 1px solid white; padding: 8px; font-size: medium; text-align: center">IOC</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">IPv4</td>
        <td style="border: 1px solid white; padding: 8px;">197[.]231[.]221[.]211</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">IPv4</td>
        <td style="border: 1px solid white; padding: 8px;">128[.]31[.]0[.]39</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">IPv4</td>
        <td style="border: 1px solid white; padding: 8px;">149[.]202[.]160[.]69</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">IPv4</td>
        <td style="border: 1px solid white; padding: 8px;">46[.]101[.]166[.]19</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">IPv4</td>
        <td style="border: 1px solid white; padding: 8px;">91[.]121[.]65[.]179</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">URL</td>
        <td style="border: 1px solid white; padding: 8px;">hxxp://www[.]btcfrog[.]com/qr/bitcoinpng[.]php?address</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">URL</td>
        <td style="border: 1px solid white; padding: 8px;">hxxp://www[.]rentasyventas[.]com/incluir/rk/imagenes[.]html</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">URL</td>
        <td style="border: 1px solid white; padding: 8px;">hxxp://www[.]rentasyventas[.]com/incluir/rk/imagenes[.]html?retencion=081525418</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">URL</td>
        <td style="border: 1px solid white; padding: 8px;">hxxp://gx7ekbenv2riucmf[.]onion</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">URL</td>
        <td style="border: 1px solid white; padding: 8px;">hxxp://57g7spgrzlojinas[.]onion</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">URL</td>
        <td style="border: 1px solid white; padding: 8px;">hxxp://xxlvbrloxvriy2c5[.]onion</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">URL</td>
        <td style="border: 1px solid white; padding: 8px;">hxxp://76jdd2ir2embyv47[.]onion</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">URL</td>
        <td style="border: 1px solid white; padding: 8px;">hxxp://cwwnhwhlz52maqm7[.]onion</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">URL</td>
        <td style="border: 1px solid white; padding: 8px;">hxxp://197[.]231[.]221[.]211 Port:9001</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">URL</td>
        <td style="border: 1px solid white; padding: 8px;">hxxp://128[.]31[.]0[.]39 Port:9191</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">URL</td>
        <td style="border: 1px solid white; padding: 8px;">hxxp://149[.]202[.]160[.]69 Port:9001</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">URL</td>
        <td style="border: 1px solid white; padding: 8px;">hxxp://46[.]101[.]166[.]19 Port:9090</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">URL</td>
        <td style="border: 1px solid white; padding: 8px;">hxxp://91[.]121[.]65[.]179 Port:9001</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">5a89aac6c8259abbba2fa2ad3fcefc6e</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">05da32043b1e3a147de634c550f1954d</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">8e97637474ab77441ae5add3f3325753</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">c9ede1054fef33720f9fa97f5e8abe49</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">f9cee5e75b7f1298aece9145ea80a1d2</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">638f9235d038a0a001d5ea7f5c5dc4ae</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">80a2af99fd990567869e9cf4039edf73</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">c39ed6f52aaa31ae0301c591802da24b</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">db349b97c37d22f5ea1d1841e3c89eb4</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">f9992dfb56a9c6c20eb727e6a26b0172</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">46d140a0eb13582852b5f778bb20cf0e</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">5bef35496fcbdbe841c82f4d1ab8b7c2</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">3c6375f586a49fc12a4de9328174f0c1</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">246c2781b88f58bc6b0da24ec71dd028</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">b7f7ad4970506e8547e0f493c80ba441</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">2b4e8612d9f8cdcf520a8b2e42779ffa</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">c61256583c6569ac13a136bfd440ca09</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">31dab68b11824153b4c975399df0354f</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">54a116ff80df6e6031059fc3036464df</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">d6114ba5f10ad67a4131ab72531f02da</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">05a00c320754934782ec5dec1d5c0476</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">f107a717f76f4f910ae9cb4dc5290594</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">7f7ccaa16fb15eb1c7399d422f8363e8</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">84c82835a5d21bbcf75a61706d8ab549</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">bec0b7aff4b107edd5b9276721137651</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">86721e64ffbd69aa6944b9672bcabb6d</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">509c41ec97bb81b0567b059aa2f50fe8</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">MD5</td>
        <td style="border: 1px solid white; padding: 8px;">8db349b97c37d22f5ea1d1841e3c89eb</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA1</td>
        <td style="border: 1px solid white; padding: 8px;">6fbb0aabe992b3bda8a9b1ecd68ea13b668f232e</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">0a73291ab5607aef7db23863cf8e72f55bcb3c273bb47f00edf011515aeb5894</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">21ed253b796f63b9e95b4e426a82303dfac5bf8062bfe669995bde2208b360fd</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">228780c8cff9044b2e48f0e92163bd78cc6df37839fe70a54ed631d3b6d826d5</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">2372862afaa8e8720bc46f93cb27a9b12646a7cbc952cc732b8f5df7aebb2450</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">2ca2d550e603d74dedda03156023135b38da3630cb014e3d00b1263358c5f00d</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">3ecc7b1ee872b45b534c9132c72d3523d2a1576ffd5763fd3c23afa79cf1f5f9</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">43d1ef55c9d33472a5532de5bbe814fefa5205297653201c30fdc91b8f21a0ed</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">49fa2e0131340da29c564d25779c0cafb550da549fae65880a6b22d45ea2067f</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">4a468603fdcb7a2eb5770705898cf9ef37aade532a7964642ecd705a74794b79</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">616e60f031b6e7c4f99c216d120e8b38763b3fafd9ac4387ed0533b15df23420</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">66334f10cb494b2d58219fa6d1c683f2dbcfc1fb0af9d1e75d49a67e5d057fc5</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">8b52f88f50a6a254280a0023cf4dc289bd82c441e648613c0c2bb9a618223604</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">8c3a91694ae0fc87074db6b3e684c586e801f4faed459587dcc6274e006422a4</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">aae9536875784fe6e55357900519f97fee0a56d6780860779a36f06765243d56</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">b9c5d4339809e0ad9a00d4d3dd26fdf44a32819a54abf846bb9b560d81391c25</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">f7c7b5e4b051ea5bd0017803f40af13bed224c4b0fd60b890b6784df5bd63494</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">09a46b3e1be080745a6d8d88d6b5bd351b1c7586ae0dc94d0c238ee36421cafa</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">149601e15002f78866ab73033eb8577f11bd489a4cea87b10c52a70fdf78d9ff</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">190d9c3e071a38cb26211bfffeb6c4bb88bd74c6bf99db9bb1f084c6a7e1df4e</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">24d004a104d4d54034dbcffc2a4b19a11f39008a575aa614ea04703480b1022c</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">2584e1521065e45ec3c17767c065429038fc6291c091097ea8b22c8a502c41dd</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">4186675cb6706f9d51167fb0f14cd3f8fcfb0065093f62b10a15f7d9a6c8d982</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">593bbcc8f34047da9960b8456094c0eaf69caaf16f1626b813484207df8bd8af</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">5ad4efd90dcde01d26cc6f32f7ce3ce0b4d4951d4b94a19aa097341aff2acaec</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">7c465ea7bcccf4f94147add808f24629644be11c0ba4823f16e8c19e0090f0ff</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">9b60c622546dc45cca64df935b71c26dcf4886d6fa811944dbc4e23db9335640</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">9fb39f162c1e1eb55fbf38e670d5e329d84542d3dfcdc341a99f5d07c4b50977</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">b47e281bfbeeb0758f8c625bed5c5a0d27ee8e0065ceeadd76b0010d226206f0</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">b66db13d17ae8bcaf586180e3dcd1e2e0a084b6bc987ac829bbff18c3be7f8b4</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">c365ddaa345cfcaff3d629505572a484cff5221933d68e4a52130b8bb7badaf9</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">d8a9879a99ac7b12e63e6bcae7f965fbf1b63d892a8649ab1d6b08ce711f7127</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">f8812f1deb8001f3b7672b6fc85640ecb123bc2304b563728e6235ccbe782d85</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">11d0f63c06263f50b972287b4bbd1abe0089bc993f73d75768b6b41e3d6f6d49</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">16493ecc4c4bc5746acbe96bd8af001f733114070d694db76ea7b5a0de7ad0ab</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">6bf1839a7e72a92a2bb18fbedf1873e4892b00ea4b122e48ae80fac5048db1a7</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">b3c39aeb14425f137b5bd0fd7654f1d6a45c0e8518ef7e209ad63d8dc6d0bac7</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">e14f1a655d54254d06d51cd23a2fa57b6ffdf371cf6b828ee483b1b1d6d21079</td> 
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">SHA256</td> 
        <td style="border: 1px solid white; padding: 8px;">e8450dd6f908b23c9cbd6011fe3d940b24c0420a208d6924e2d920f92c894a96</td> 
      </tr>
    </tbody>
  </table>
</div>


<br>


# YARA Rules

The following YARA rules can be used to detect Wannacry Ransomware.

- 1) By CISA: **[Link](https://www.cisa.gov/news-events/alerts/2017/05/12/indicators-associated-wannacry-ransomware)**
- 2) By Yara - Rules: **[Link](https://github.com/Yara-Rules/rules/blob/master/malware/RANSOM_MS17-010_Wannacrypt.yar)**

<br>

# MITRE ATT&CK Mapping

<div style="padding-left: 50px; padding-right: 50px;" class="table-container">
  <table style="border-collapse: collapse; width: 100%; border: 1px solid white; font-size: small;">
    <thead>
      <tr>
        <th style="border: 1px solid white; padding: 8px; font-size: medium; text-align: center">Domain</th>
        <th style="border: 1px solid white; padding: 8px; font-size: medium; text-align: center">ID</th>
        <th style="border: 1px solid white; padding: 8px; font-size: medium; text-align: center">Name</th>
        <th style="border: 1px solid white; padding: 8px; font-size: medium; text-align: center">Use</th>
        <th style="border: 1px solid white; padding: 8px; font-size: medium; text-align: center">Enterprise/ICS</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1543.003</td>
        <td style="border: 1px solid white; padding: 8px;">Create or Modify System Process: Windows Service</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry creates the service "mssecsvc2.0" with the display name "Microsoft Security Center (2.0) Service."</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1486</td>
        <td style="border: 1px solid white; padding: 8px;">Data Encrypted for Impact</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry encrypts user files and demands that a ransom be paid in Bitcoin to decrypt those files.</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1573.002</td>
        <td style="border: 1px solid white; padding: 8px;">Encrypted Channel: Asymmetric Cryptography</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry uses Tor for command and control traffic and routes a custom cryptographic protocol over the Tor circuit.</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1210</td>
        <td style="border: 1px solid white; padding: 8px;">Exploitation of Remote Services</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry uses an exploit in SMBv1 to spread itself to other remote systems on a network.</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1083</td>
        <td style="border: 1px solid white; padding: 8px;">File and Directory Discovery</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry searches for variety of user files by file extension before encrypting them using RSA and AES, including Office, PDF, image, audio, video, source code, archive/compression format, and key and certificate files.</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1222.001</td>
        <td style="border: 1px solid white; padding: 8px;">File and Directory Permissions Modification: Windows File and Directory Permissions Modification</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry uses attrib +h and icacls . /grant Everyone:F /T /C /Q to make some of its files hidden and grant all users full access controls.</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1564.001</td>
        <td style="border: 1px solid white; padding: 8px;">Hide Artifacts: Hidden Files and Directories</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry uses attrib +h to make some of its files hidden.</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1490</td>
        <td style="border: 1px solid white; padding: 8px;">Inhibit System Recovery</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry uses vssadmin, wbadmin, bcdedit, and wmic to delete and disable operating system recovery features.</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1570</td>
        <td style="border: 1px solid white; padding: 8px;">Lateral Tool Transfer</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry attempts to copy itself to remote computers after gaining access via an SMB exploit.</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1120</td>
        <td style="border: 1px solid white; padding: 8px;">Peripheral Device Discovery</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry contains a thread that will attempt to scan for new attached drives every few seconds. If one is identified, it will encrypt the files on the attached device.</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1090.003</td>
        <td style="border: 1px solid white; padding: 8px;">Proxy: Multi-hop Proxy</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry uses Tor for command and control traffic.</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1563.002</td>
        <td style="border: 1px solid white; padding: 8px;">Remote Service Session Hijacking: RDP Hijacking</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry enumerates current remote desktop sessions and tries to execute the malware on each session.</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1018</td>
        <td style="border: 1px solid white; padding: 8px;">Remote System Discovery</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry scans its local network segment for remote systems to try to exploit and copy itself to.</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1489</td>
        <td style="border: 1px solid white; padding: 8px;">Service Stop</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry attempts to kill processes associated with Exchange, Microsoft SQL Server, and MySQL to make it possible to encrypt their data stores.</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1016</td>
        <td style="border: 1px solid white; padding: 8px;">System Network Configuration Discovery</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry will attempt to determine the local network segment it is a part of.</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
        <td style="border: 1px solid white; padding: 8px;">T1047</td>
        <td style="border: 1px solid white; padding: 8px;">Windows Management Instrumentation</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry utilizes wmic to delete shadow copies.</td>
        <td style="border: 1px solid white; padding: 8px;">Enterprise</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">ICS</td>
        <td style="border: 1px solid white; padding: 8px;">T0866</td>
        <td style="border: 1px solid white; padding: 8px;">Exploitation of Remote Services</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry initially infected IT networks, but by means of an exploit (particularly the SMBv1-targeting MS17-010 vulnerability) spread to industrial networks.</td>
        <td style="border: 1px solid white; padding: 8px;">ICS</td>
      </tr>
      <tr>
        <td style="border: 1px solid white; padding: 8px;">ICS</td>
        <td style="border: 1px solid white; padding: 8px;">T0867</td>
        <td style="border: 1px solid white; padding: 8px;">Lateral Tool Transfer</td>
        <td style="border: 1px solid white; padding: 8px;">WannaCry can move laterally through industrial networks by means of the SMB service.</td>
        <td style="border: 1px solid white; padding: 8px;">ICS</td>
      </tr>
    </tbody>
  </table>
</div>

<br>

# Impact & Solution
Ransomware can affect not only individual users but also businesses, resulting in several serious consequences, such as:
- Loss of sensitive or proprietary data, either temporarily or permanently.
- Interruptions to normal business operations.
- Financial costs associated with recovering systems and files.
- Damage to the organization’s reputation.

**Paying the ransom does not ensure that encrypted files will be restored.** It only guarantees that the attackers receive payment, and in some cases, access to the victim’s financial information. Moreover, even if the files are decrypted, the malware may still remain on the system.

<br>

### Steps for Prevention as listed by CISA
- 1) Apply the Microsoft patch for the MS17-010 SMB vulnerability dated March 14, 2017.

- 2) Enable strong spam filters to prevent phishing emails from reaching the end users and authenticate in-bound email using technologies like Sender Policy Framework (SPF), Domain Message Authentication Reporting and Conformance (DMARC), and DomainKeys Identified Mail (DKIM) to prevent email spoofing. 

- 3) Scan all incoming and outgoing emails to detect threats and filter executable files from reaching the end users.
Ensure antivirus and anti-malware solutions are set to automatically conduct regular scans.

- 4) Manage the use of privileged accounts. Implement the principle of least privilege. No users should be assigned administrative access unless absolutely needed. Those with a need for administrator accounts should only use them when necessary.

- 5) Configure access controls including file, directory, and network share permissions with least privilege in mind. If a user only needs to read specific files, they should not have write access to those files, directories, or shares. 

- 6) Disable macro scripts from Microsoft Office files transmitted via email. Consider using Office Viewer software to open Microsoft Office files transmitted via email instead of full Office suite applications.
Develop, institute, and practice employee education programs for identifying scams, malicious links, and attempted social engineering.

- 7) Run regular penetration tests against the network, no less than once a year. Ideally, run these as often as possible and practical.

- 8) Test your backups to ensure they work correctly upon use.

<br>

# References
1) WannaCry ransomware attack - Wikipedia **([Link](https://en.wikipedia.org/wiki/WannaCry_ransomware_attack))**
2) SMB Exploited: WannaCry Use of "EternalBlue" - Google Cloud **([Link](https://cloud.google.com/blog/topics/threat-intelligence/smb-exploited-wannacry-use-of-eternalblue/))**
3) CVE-2017-0144 Detail - NIST **([Link](https://nvd.nist.gov/vuln/detail/CVE-2017-0144))**
4) Wannacry IOCs and Technical details - Critical Start **([Link](https://www.criticalstart.com/wannacry-iocs-and-technical-details/))**
5) Indicators Associated With WannaCry Ransomware - CISA **([Link](https://www.cisa.gov/news-events/alerts/2017/05/12/indicators-associated-wannacry-ransomware))**
6) RANSOM_MS17-010_Wannacrypt.yar - YARA-Rules **([Link](https://github.com/Yara-Rules/rules/blob/master/malware/RANSOM_MS17-010_Wannacrypt.yar))**
7) MITRE ATT&CK Framework for WannaCry - MITRE ATT&CK **([Link](https://attack.mitre.org/software/S0366/))**
8) Player 3 Has Entered the Game: Say Hello to 'WannaCry' - Cisco Talos (Talos Intelligence) **([Link](https://blog.talosintelligence.com/wannacry/))**